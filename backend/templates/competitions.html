{% extends "base.html" %}
{% block content %}
<h1>Соревнования</h1>

{% set _uid = request.session.get('uid') if request.session else None %}

<div class="table-responsive">
  <table class="table">
    <thead>
      <tr>
        <th>Дата</th>
        <th>Название</th>
        <th>Город</th>
        <th style="width:280px;"></th>
      </tr>
    </thead>
    <tbody>
    {% for c in comps %}
      <tr>
        <td>{{ c.start_date.strftime("%d.%m.%Y") }}</td>
        <td>
          <a href="/competitions/{{ c.slug }}">{{ c.title }}</a>
          {% if c.series or c.stage %}
            <div class="muted" style="font-size:0.9rem; margin-top:4px; display:flex; gap:6px; flex-wrap:wrap;">
              {% if c.series %}<span>Серия: {{ c.series.name }}</span>{% endif %}
              {% if c.stage %}<span>Этап: {{ c.stage }}</span>{% endif %}
            </div>
          {% endif %}
        </td>
        <td>{{ c.city }}</td>
        <td>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <a class="btn" href="/competitions/{{ c.slug }}">Подробнее</a>
            {% if c.regulation_pdf %}<a class="btn" href="{{ c.regulation_pdf }}" target="_blank">Положение</a>{% endif %}
            {% if c.is_open %}
              <a class="btn" href="/competitions/{{ c.slug }}/register">Регистрация</a>

              {% if _uid %}
                <form method="post" action="/competitions/{{ c.slug }}/quick-register" style="display:inline;">
                  <input type="hidden" name="distance" value="">
                  <button class="btn primary" type="submit">Быстрая запись</button>
                </form>
              {% else %}
                <a class="btn primary" href="/auth/login">Быстрая запись (войти)</a>
              {% endif %}

            {% endif %}
          </div>
        </td>
      </tr>
    {% else %}
      <tr><td colspan="4">Нет стартов</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
